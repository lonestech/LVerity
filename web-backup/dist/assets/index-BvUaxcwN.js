import{r as n,j as e,s as o}from"./index-ps_LC9pP.js";import{P as S,M as w,C as y,S as C}from"./index-C4NSdVJi.js";import{d as m}from"./device-BocKzIwm.js";import{F as a,B as D}from"./index-lekb2yts.js";import{a as F}from"./row-COHH8Rx0.js";import{I as d}from"./index-CLICSLSb.js";import{S as x}from"./index-gmqBHMrU.js";import{P as M}from"./index-zoe9Kp3s.js";function R(){const[f,c]=n.useState(!1),[j,h]=n.useState(!1),[r,p]=n.useState(null),[l,b]=n.useState(null),[u]=a.useForm(),i=n.useRef(),I=async()=>{if(l)try{await m.delete(l.id),o.success("设备删除成功"),i.current&&i.current.reload(),h(!1)}catch(t){o.error(t.message||"删除失败")}},g=async()=>{try{const t=await u.validateFields();r?(await m.update(r.id,t),o.success("设备更新成功")):(await m.create(t),o.success("设备创建成功")),c(!1),i.current&&i.current.reload()}catch(t){o.error(t.message||"操作失败")}},v=[{title:"ID",dataIndex:"id",width:220,copyable:!0,ellipsis:!0},{title:"名称",dataIndex:"name",width:150},{title:"状态",dataIndex:"status",width:100,valueType:"select",valueEnum:{normal:{text:"正常",status:"Success"},offline:{text:"离线",status:"Default"},blocked:{text:"已封禁",status:"Error"},suspect:{text:"可疑",status:"Warning"},disabled:{text:"已禁用",status:"Warning"}},render:(t,s)=>e.jsx(C,{status:s.status})},{title:"最后心跳",dataIndex:"lastHeartbeat",width:180},{title:"最后在线",dataIndex:"lastSeen",width:180},{title:"操作",width:180,valueType:"option",render:(t,s)=>[e.jsx("a",{onClick:()=>{p(s),u.setFieldsValue(s),c(!0)},children:"编辑"},"edit"),e.jsx("a",{style:{color:"#ff4d4f"},onClick:()=>{b(s),h(!0)},children:"删除"},"delete")]}];return e.jsxs(M,{children:[e.jsx(S,{headerTitle:"设备管理",actionRef:i,rowKey:"id",search:{labelWidth:120},toolBarRender:()=>[e.jsx(D,{type:"primary",onClick:()=>{p(null),u.resetFields(),c(!0)},icon:e.jsx(F,{}),children:"添加设备"},"create")],request:async t=>{const s=await m.list({page:t.current,pageSize:t.pageSize,...t});return{data:s.list,total:s.total,success:!0}},columns:v}),e.jsx(w,{title:r?"编辑设备":"添加设备",open:f,onOk:g,onCancel:()=>c(!1),width:540,children:e.jsxs(a,{form:u,layout:"vertical",name:"deviceForm",initialValues:{status:"normal"},children:[e.jsx(a.Item,{name:"name",label:"设备名称",rules:[{required:!0,message:"请输入设备名称"}],children:e.jsx(d,{placeholder:"请输入设备名称"})}),!r&&e.jsxs(e.Fragment,{children:[e.jsx(a.Item,{name:"diskID",label:"磁盘ID",rules:[{required:!0,message:"请输入磁盘ID"}],children:e.jsx(d,{placeholder:"请输入磁盘ID"})}),e.jsx(a.Item,{name:"bios",label:"BIOS序列号",rules:[{required:!0,message:"请输入BIOS序列号"}],children:e.jsx(d,{placeholder:"请输入BIOS序列号"})}),e.jsx(a.Item,{name:"motherboard",label:"主板序列号",rules:[{required:!0,message:"请输入主板序列号"}],children:e.jsx(d,{placeholder:"请输入主板序列号"})})]}),r&&e.jsx(a.Item,{name:"status",label:"状态",rules:[{required:!0,message:"请选择状态"}],children:e.jsxs(x,{children:[e.jsx(x.Option,{value:"normal",children:"正常"}),e.jsx(x.Option,{value:"blocked",children:"已封禁"}),e.jsx(x.Option,{value:"disabled",children:"已禁用"})]})}),e.jsx(a.Item,{name:"description",label:"描述",children:e.jsx(d.TextArea,{rows:4,placeholder:"请输入设备描述"})})]})}),e.jsx(y,{title:"删除设备",visible:!!j,onConfirm:I,onCancel:()=>h(!1),content:e.jsxs("div",{children:[e.jsxs("p",{children:['确定要删除设备 "',l==null?void 0:l.name,'" 吗？']}),e.jsx("p",{children:"此操作不可逆，删除后将无法恢复。"})]})})]})}export{R as default};
