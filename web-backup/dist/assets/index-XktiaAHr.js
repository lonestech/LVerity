import{r as f,g as I,m as H,a as M,C as _,c as A,p as U,S as K,u as V,b as B,j as n,d as X}from"./index-ps_LC9pP.js";import{u as b}from"./useQuery-hKhGHq8O.js";import{r as h}from"./request-Cf19XcXK.js";import{P as Q}from"./index-zoe9Kp3s.js";import{R as S,C as u}from"./row-COHH8Rx0.js";import{C}from"./index-Ckz2MU5i.js";import"./utils-km2FGkQ4.js";const Y=e=>{const{value:a,formatter:r,precision:t,decimalSeparator:s,groupSeparator:m="",prefixCls:o}=e;let i;if(typeof r=="function")i=r(a);else{const l=String(a),d=l.match(/^(-?)(\d*)(\.(\d+))?$/);if(!d||l==="-")i=l;else{const x=d[1];let g=d[2]||"0",c=d[4]||"";g=g.replace(/\B(?=(\d{3})+(?!\d))/g,m),typeof t=="number"&&(c=c.padEnd(t,"0").slice(0,t>0?t:0)),c&&(c=`${s}${c}`),i=[f.createElement("span",{key:"int",className:`${o}-content-value-int`},x,g),c&&f.createElement("span",{key:"decimal",className:`${o}-content-value-decimal`},c)]}}return f.createElement("span",{className:`${o}-content-value`},i)},G=e=>{const{componentCls:a,marginXXS:r,padding:t,colorTextDescription:s,titleFontSize:m,colorTextHeading:o,contentFontSize:i,fontFamily:l}=e;return{[a]:Object.assign(Object.assign({},M(e)),{[`${a}-title`]:{marginBottom:r,color:s,fontSize:m},[`${a}-skeleton`]:{paddingTop:t},[`${a}-content`]:{color:o,fontSize:i,fontFamily:l,[`${a}-content-value`]:{display:"inline-block",direction:"ltr"},[`${a}-content-prefix, ${a}-content-suffix`]:{display:"inline-block"},[`${a}-content-prefix`]:{marginInlineEnd:r},[`${a}-content-suffix`]:{marginInlineStart:r}}})}},J=e=>{const{fontSizeHeading3:a,fontSize:r}=e;return{titleFontSize:r,contentFontSize:a}},W=I("Statistic",e=>{const a=H(e,{});return[G(a)]},J);var Z=function(e,a){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)a.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(r[t[s]]=e[t[s]]);return r};const p=e=>{const{prefixCls:a,className:r,rootClassName:t,style:s,valueStyle:m,value:o=0,title:i,valueRender:l,prefix:d,suffix:x,loading:g=!1,formatter:c,precision:v,decimalSeparator:E=".",groupSeparator:$=",",onMouseEnter:N,onMouseLeave:L}=e,T=Z(e,["prefixCls","className","rootClassName","style","valueStyle","value","title","valueRender","prefix","suffix","loading","formatter","precision","decimalSeparator","groupSeparator","onMouseEnter","onMouseLeave"]),{getPrefixCls:D,direction:F,statistic:y}=f.useContext(_),j=D("statistic",a),[R,k,P]=W(j),w=f.createElement(Y,{decimalSeparator:E,groupSeparator:$,prefixCls:j,formatter:c,precision:v,value:o}),q=A(j,{[`${j}-rtl`]:F==="rtl"},y==null?void 0:y.className,r,t,k,P),z=U(T,{aria:!0,data:!0});return R(f.createElement("div",Object.assign({},z,{className:q,style:Object.assign(Object.assign({},y==null?void 0:y.style),s),onMouseEnter:N,onMouseLeave:L}),i&&f.createElement("div",{className:`${j}-title`},i),f.createElement(K,{paragraph:!1,loading:g,className:`${j}-skeleton`},f.createElement("div",{style:m,className:`${j}-content`},d&&f.createElement("span",{className:`${j}-content-prefix`},d),l?l(w):w,x&&f.createElement("span",{className:`${j}-content-suffix`},x)))))},ee=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function te(e,a){let r=e;const t=/\[[^\]]*]/g,s=(a.match(t)||[]).map(l=>l.slice(1,-1)),m=a.replace(t,"[]"),o=ee.reduce((l,d)=>{let[x,g]=d;if(l.includes(x)){const c=Math.floor(r/g);return r-=c*g,l.replace(new RegExp(`${x}+`,"g"),v=>{const E=v.length;return c.toString().padStart(E,"0")})}return l},m);let i=0;return o.replace(t,()=>{const l=s[i];return i+=1,l})}function ne(e,a){const{format:r=""}=a,t=new Date(e).getTime(),s=Date.now(),m=Math.max(t-s,0);return te(m,r)}var se=function(e,a){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)a.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(r[t[s]]=e[t[s]]);return r};const ae=1e3/30;function re(e){return new Date(e).getTime()}const ie=e=>{const{value:a,format:r="HH:mm:ss",onChange:t,onFinish:s}=e,m=se(e,["value","format","onChange","onFinish"]),o=V(),i=f.useRef(null),l=()=>{s==null||s(),i.current&&(clearInterval(i.current),i.current=null)},d=()=>{const c=re(a);c>=Date.now()&&(i.current=setInterval(()=>{o(),t==null||t(c-Date.now()),c<Date.now()&&l()},ae))};f.useEffect(()=>(d(),()=>{i.current&&(clearInterval(i.current),i.current=null)}),[a]);const x=(c,v)=>ne(c,Object.assign(Object.assign({},v),{format:r})),g=c=>B(c,{title:void 0});return f.createElement(p,Object.assign({},m,{value:a,valueRender:g,formatter:x}))},oe=f.memo(ie);p.Countdown=oe;const O={getOverview:()=>h.get("/api/stats/overview"),getDeviceStats:()=>h.get("/api/stats/devices"),getLicenseStats:()=>h.get("/api/licenses/stats"),getUserActivityStats:e=>h.get("/api/stats/user-activity",{params:e}),getAlertStats:()=>h.get("/api/stats/alerts")};function ge(){const{data:e,isLoading:a}=b({queryKey:["stats","overview"],queryFn:async()=>(await O.getOverview()).data}),{data:r,isLoading:t}=b({queryKey:["stats","devices"],queryFn:async()=>(await O.getDeviceStats()).data}),{data:s,isLoading:m}=b({queryKey:["stats","licenses"],queryFn:async()=>(await O.getLicenseStats()).data}),{data:o,isLoading:i}=b({queryKey:["stats","alerts"],queryFn:async()=>(await O.getAlertStats()).data}),l=a||t||m||i;return n.jsx(Q,{children:n.jsx(X,{spinning:l,children:n.jsxs(S,{gutter:[16,16],children:[n.jsx(u,{span:24,children:n.jsx(C,{title:"系统概览",children:n.jsxs(S,{gutter:16,children:[n.jsx(u,{span:6,children:n.jsx(p,{title:"总用户数",value:(e==null?void 0:e.totalUsers)||0})}),n.jsx(u,{span:6,children:n.jsx(p,{title:"总设备数",value:(e==null?void 0:e.totalDevices)||0})}),n.jsx(u,{span:6,children:n.jsx(p,{title:"总许可证数",value:(e==null?void 0:e.totalLicenses)||0})}),n.jsx(u,{span:6,children:n.jsx(p,{title:"活跃告警数",value:(e==null?void 0:e.activeAlerts)||0})})]})})}),n.jsx(u,{span:8,children:n.jsx(C,{title:"设备状态",children:n.jsxs(S,{gutter:16,children:[n.jsx(u,{span:8,children:n.jsx(p,{title:"在线",value:(r==null?void 0:r.online)||0})}),n.jsx(u,{span:8,children:n.jsx(p,{title:"离线",value:(r==null?void 0:r.offline)||0})}),n.jsx(u,{span:8,children:n.jsx(p,{title:"维护中",value:(r==null?void 0:r.maintenance)||0})})]})})}),n.jsx(u,{span:8,children:n.jsx(C,{title:"许可证状态",children:n.jsxs(S,{gutter:16,children:[n.jsx(u,{span:8,children:n.jsx(p,{title:"生效中",value:(s==null?void 0:s.active)||0})}),n.jsx(u,{span:8,children:n.jsx(p,{title:"已过期",value:(s==null?void 0:s.expired)||0})}),n.jsx(u,{span:8,children:n.jsx(p,{title:"已吊销",value:(s==null?void 0:s.revoked)||0})})]})})}),n.jsx(u,{span:8,children:n.jsx(C,{title:"系统告警",children:n.jsxs(S,{gutter:16,children:[n.jsx(u,{span:8,children:n.jsx(p,{title:"严重",value:(o==null?void 0:o.critical)||0})}),n.jsx(u,{span:8,children:n.jsx(p,{title:"警告",value:(o==null?void 0:o.warning)||0})}),n.jsx(u,{span:8,children:n.jsx(p,{title:"信息",value:(o==null?void 0:o.info)||0})})]})})})]})})})}export{ge as default};
