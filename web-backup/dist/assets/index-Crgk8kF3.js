import{r as o,n as D,j as e,K as c,s as u}from"./index-ps_LC9pP.js";import{u as p}from"./useMutation-B4L5bIWH.js";import{P as O,M as E,C as K,S as R}from"./index-C4NSdVJi.js";import{F as i,B as T}from"./index-lekb2yts.js";import{a as U}from"./row-COHH8Rx0.js";import{I as f}from"./index-CLICSLSb.js";import{S as l}from"./index-gmqBHMrU.js";import{P as V}from"./index-zoe9Kp3s.js";import"./utils-km2FGkQ4.js";function H(){const[a]=i.useForm(),I=o.useRef(),[S,r]=o.useState(!1),[n,d]=o.useState(null),[w,m]=o.useState(!1),[j,x]=o.useState(null),h=D(),y=p({mutationFn:t=>c.create(t),onSuccess:()=>{u.success("用户创建成功"),r(!1),a.resetFields(),h.invalidateQueries({queryKey:["users"]})}}),v=p({mutationFn:({id:t,data:s})=>c.update(t,s),onSuccess:()=>{u.success("用户更新成功"),r(!1),d(null),a.resetFields(),h.invalidateQueries({queryKey:["users"]})}}),b=p({mutationFn:t=>c.delete(t),onSuccess:()=>{u.success("用户删除成功"),m(!1),x(null),h.invalidateQueries({queryKey:["users"]})}}),C=async()=>{try{const t=await a.validateFields();n?await v.mutateAsync({id:n.id,data:t}):await y.mutateAsync(t)}catch(t){u.error(t.message||"操作失败")}},F=async()=>{if(j)try{await b.mutateAsync(j.id)}catch(t){u.error(t.message||"删除失败")}},M=[{title:"用户名",dataIndex:"username",width:200},{title:"邮箱",dataIndex:"email",width:250},{title:"角色",dataIndex:"roleID",width:150,valueEnum:{admin:{text:"管理员"},user:{text:"普通用户"}}},{title:"状态",dataIndex:"status",width:100,valueType:"select",valueEnum:{active:{text:"正常",status:"Success"},inactive:{text:"禁用",status:"Default"},suspended:{text:"暂停",status:"Warning"}},render:(t,s)=>e.jsx(R,{status:s.status})},{title:"创建时间",dataIndex:"createdAt",width:200},{title:"操作",width:180,valueType:"option",render:(t,s)=>[e.jsx("a",{onClick:()=>{d(s),a.setFieldsValue(s),r(!0)},children:"编辑"},"edit"),s.roleID!=="admin"&&e.jsx("a",{style:{color:"#ff4d4f"},onClick:()=>{x(s),m(!0)},children:"删除"},"delete")]}];return e.jsxs(V,{children:[e.jsx(O,{headerTitle:"用户管理",actionRef:I,rowKey:"id",search:{labelWidth:120},toolBarRender:()=>[e.jsx(T,{type:"primary",onClick:()=>{d(null),a.resetFields(),r(!0)},icon:e.jsx(U,{}),children:"添加用户"},"create")],request:async t=>{const{current:s,pageSize:q,...P}=t,g=await c.list({page:s,pageSize:q,...P});return{data:g.list,total:g.total,success:!0}},columns:M}),e.jsx(E,{title:n?"编辑用户":"添加用户",open:S,onOk:C,onCancel:()=>{r(!1),d(null),a.resetFields()},confirmLoading:y.isPending||v.isPending,width:600,children:e.jsxs(i,{form:a,layout:"vertical",children:[e.jsx(i.Item,{name:"username",label:"用户名",rules:[{required:!0,message:"请输入用户名"}],children:e.jsx(f,{placeholder:"请输入用户名"})}),e.jsx(i.Item,{name:"email",label:"邮箱",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入有效的邮箱格式"}],children:e.jsx(f,{placeholder:"请输入邮箱"})}),!n&&e.jsx(i.Item,{name:"password",label:"密码",rules:[{required:!0,message:"请输入密码"},{min:6,message:"密码长度不能少于6位"}],children:e.jsx(f.Password,{placeholder:"请输入密码"})}),e.jsx(i.Item,{name:"roleID",label:"角色",rules:[{required:!0,message:"请选择角色"}],children:e.jsxs(l,{placeholder:"请选择角色",children:[e.jsx(l.Option,{value:"admin",children:"管理员"}),e.jsx(l.Option,{value:"user",children:"普通用户"})]})}),n&&e.jsx(i.Item,{name:"status",label:"状态",children:e.jsxs(l,{placeholder:"请选择状态",children:[e.jsx(l.Option,{value:"active",children:"正常"}),e.jsx(l.Option,{value:"inactive",children:"禁用"}),e.jsx(l.Option,{value:"suspended",children:"暂停"})]})})]})}),e.jsx(K,{title:"删除用户",content:"确定要删除此用户吗？删除后将无法恢复。",visible:w,onConfirm:F,onCancel:()=>{m(!1),x(null)}})]})}export{H as default};
